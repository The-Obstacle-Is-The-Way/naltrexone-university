# Repository Guidelines

## Project Structure & Module Organization

- `app/`: Next.js App Router pages, layouts, and API routes (e.g. `app/api/health/route.ts`).
- `components/`: shared React components; `components/ui/` contains shadcn/ui primitives.
- `lib/`: core server/client utilities (auth, Stripe, env, DB). Prefer importing via `@/…`.
- `db/`: Drizzle schema in `db/schema.ts`; migrations in `db/migrations/` are generated by `drizzle-kit`.
- `content/questions/`: MDX question content.
- `tests/`: `unit/`, `integration/`, and `e2e/` suites.
- `docs/`: architecture docs and specs; `docs/specs/master_spec.md` is the technical source of truth.

## Build, Test, and Development Commands

- Install: `pnpm install` (requires Node `>=20.9.0`).
- Env: `cp .env.example .env` and set `DATABASE_URL`, Clerk, and Stripe keys (never commit `.env`).
- Dev: `pnpm dev` (local server on `http://localhost:3000`).
- Build/Run: `pnpm build` then `pnpm start`.
- DB: `pnpm db:migrate`, `pnpm db:seed`, `pnpm db:studio`.
- Quality gates: `pnpm lint`, `pnpm typecheck`.

## Coding Style & Naming Conventions

- TypeScript + React (Next.js). Keep modules small and prefer pure functions in `lib/`.
- Biome is the source of truth for style: 2-space indents, single quotes, semicolons, trailing commas.
- Avoid non-null assertions (`!`) and unused imports/variables (Biome errors).
- Tests: `*.test.ts(x)` for Vitest; `*.spec.ts` under `tests/e2e/` for Playwright.

## Testing Guidelines

- Unit tests: `pnpm test` (watch) or `pnpm test --run` (CI-style run).
- Integration tests: `pnpm test:integration` (requires a working `DATABASE_URL`).
- E2E tests: `pnpm test:e2e` (Playwright starts Next.js automatically via `playwright.config.ts`).

## Commit & Pull Request Guidelines

- Commit subjects follow an imperative style (examples from history: `Add …`, `Fix …`, `Refactor …`, `Enhance …`); use optional tags like `[BASELINE]` when applicable.
- PRs should include: a short problem/solution summary, any linked spec/ADR updates in `docs/`, and screenshots/GIFs for UI changes.
- Before opening a PR, ensure CI-equivalent checks pass locally: `pnpm typecheck`, `pnpm lint`, `pnpm test --run`, `pnpm test:integration`, `pnpm build`.
